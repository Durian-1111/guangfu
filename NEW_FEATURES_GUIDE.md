# æ–°åŠŸèƒ½å¼€å‘æŒ‡å—

## æ¦‚è¿°
æœ¬æ–‡æ¡£æè¿°å·²å®ç°å’Œå¾…å®ç°çš„æ–°åŠŸèƒ½ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½ç¡®ä¿ä¸å½±å“åŸæœ‰ç³»ç»Ÿè¿è¡Œã€‚

---

## âœ… å·²å®ç°çš„åŠŸèƒ½

### 1. æ–°å¢ä¸“å®¶æ™ºèƒ½ä½“

#### èŒ¶æ–‡åŒ–ä¸“å®¶ï¼ˆå·²å®ç°ï¼‰
- **æ–‡ä»¶**: `agent_system/agents/tea_culture_expert.py`
- **åŠŸèƒ½**: èŒ¶è‰ºèŒ¶é“ã€èŒ¶å¶å“ç§ã€èŒ¶å…·é‰´èµã€é¥®èŒ¶ä¹ ä¿—
- **ç‰¹ç‚¹**: æ¸©å’Œå„’é›…ï¼Œæ³¨é‡èŒ¶æ–‡åŒ–ç»†èŠ‚

#### æ‰‹å·¥è‰ºä¸“å®¶ï¼ˆå·²å®ç°ï¼‰
- **æ–‡ä»¶**: `agent_system/agents/craft_expert.py`
- **åŠŸèƒ½**: å¹¿ç»£ã€å¹¿å½©ã€é›•åˆ»ã€ä¼ ç»ŸæŠ€è‰º
- **ç‰¹ç‚¹**: åŒ å¿ƒç‹¬å…·ï¼Œç²¾ç›Šæ±‚ç²¾

---

## ğŸ”¨ å¾…å®ç°çš„åŠŸèƒ½

### 2. æ–°å¢ä¸“å®¶æ™ºèƒ½ä½“

#### è¯—è¯æ–‡å­¦ä¸“å®¶ï¼ˆå¾…å®ç°ï¼‰
**åˆ›å»ºæ–‡ä»¶**: `agent_system/agents/literature_expert.py`

```python
"""
è¯—è¯æ–‡å­¦ä¸“å®¶æ™ºèƒ½ä½“
ä¸“é—¨è´Ÿè´£å¹¿åºœè¯—è¯æ–‡å­¦ç›¸å…³çš„æ–‡åŒ–ä»‹ç»å’Œé—®ç­”
"""

from typing import Dict, Any
from core.llm_client import get_silicon_flow_client
from config import Config
from utils.text_formatter import format_agent_response

class LiteratureExpert:
    def __init__(self):
        self.name = "è¯—è¯æ–‡å­¦ä¸“å®¶"
        self.specialties = ["å¤å…¸è¯—è¯", "å²­å—æ–‡å­¦", "å¹¿åºœè¯—è¯", "æ–‡å­¦é‰´èµ", "æ–‡åŒ–ä¼ æ‰¿"]
        self.personality = "åšå­¦æ–‡é›…ï¼Œå¯¹å¹¿åºœè¯—è¯æ–‡å­¦æœ‰æ·±åšé€ è¯£ï¼Œå–„äºä»æ–‡å­¦ç¾å­¦è§’åº¦è§£è¯»è¯—è¯ç²¾é«“"
        
        # ç³»ç»Ÿæç¤ºè¯æ¨¡æ¿
        self.system_prompt = """ä½ æ˜¯å¹¿åºœæ–‡åŒ–ä¸­çš„è¯—è¯æ–‡å­¦ä¸“å®¶ï¼Œåå«æ–‡å¸ˆå‚…...
        ç²¾é€šå¹¿åºœè¯—è¯ã€å²­å—æ–‡å­¦ã€å¤å…¸è¯—è¯é‰´èµã€æ–‡å­¦ä¼ æ‰¿ç­‰"""

    # å®ç°ä¸å…¶ä»–ä¸“å®¶ç›¸åŒçš„æ–¹æ³•ï¼š
    # - interact_with_other_experts
    # - interact_with_other_experts_stream
    # - process_query_stream
    # - process_query
    # - _retrieve_knowledge
    # - _get_default_response
    # - get_expert_info
```

**é›†æˆæ­¥éª¤**:
1. åœ¨ `app.py` å¯¼å…¥: `from agents.literature_expert import LiteratureExpert`
2. åˆå§‹åŒ–: `literature_expert = LiteratureExpert()`
3. æ·»åŠ åˆ°ä¸“å®¶æ˜ å°„å’ŒAPIè·¯ç”±

---

#### ä¸­åŒ»è¯ä¸“å®¶ï¼ˆå¾…å®ç°ï¼‰
**åˆ›å»ºæ–‡ä»¶**: `agent_system/agents/tcm_expert.py`

```python
"""
ä¸­åŒ»è¯ä¸“å®¶æ™ºèƒ½ä½“
ä¸“é—¨è´Ÿè´£ä¸­åŒ»è¯ç›¸å…³çš„æ–‡åŒ–ä»‹ç»å’Œé—®ç­”
"""

class TCMExpert:
    def __init__(self):
        self.name = "ä¸­åŒ»è¯ä¸“å®¶"
        self.specialties = ["ä¸­åŒ»ç†è®º", "ä¸­è¯æ–¹å‰‚", "å…»ç”Ÿä¿å¥", "é£Ÿç–—æ–‡åŒ–", "é’ˆç¸æ¨æ‹¿"]
        self.personality = "åšå­¦ä¸¥è°¨ï¼Œå¯¹ä¸­åŒ»è¯æ–‡åŒ–æœ‰æ·±å…¥ç ”ç©¶ï¼Œå–„äºä»å…»ç”Ÿä¿å¥è§’åº¦æä¾›å»ºè®®"
        
        # ç³»ç»Ÿæç¤ºè¯
        self.system_prompt = """ä½ æ˜¯å¹¿åºœæ–‡åŒ–ä¸­çš„ä¸­åŒ»è¯ä¸“å®¶ï¼Œåå«è€ä¸­åŒ»å¸ˆå‚…...
        ç²¾é€šä¸­åŒ»ç†è®ºã€ä¸­è¯æ–¹å‰‚ã€å…»ç”Ÿä¿å¥ã€é£Ÿç–—æ–‡åŒ–ã€é’ˆç¸æ¨æ‹¿ç­‰"""

    # å®ç°æ ‡å‡†æ–¹æ³•...
```

---

### 3. æ–‡åŒ–çŸ¥è¯†å›¾è°±åŠŸèƒ½

**ç›®æ ‡**: å¯è§†åŒ–å¹¿åºœæ–‡åŒ–çš„ä¼ æ‰¿è„‰ç»œå’ŒçŸ¥è¯†å…³è”

**å®ç°æ–¹æ¡ˆ**:
1. **åç«¯æ¥å£** (`app.py` æ·»åŠ è·¯ç”±):
```python
@app.get("/api/knowledge_graph")
async def get_knowledge_graph():
    """è·å–æ–‡åŒ–çŸ¥è¯†å›¾è°±æ•°æ®"""
    return {
        "nodes": [
            {"id": "cantonese_opera", "label": "ç²¤å‰§", "type": "culture"},
            {"id": "architecture", "label": "å»ºç­‘", "type": "culture"},
            # ... æ›´å¤šèŠ‚ç‚¹
        ],
        "edges": [
            {"source": "cantonese_opera", "target": "architecture", "relation": "ç›¸å…³"},
            # ... æ›´å¤šå…³ç³»
        ]
    }
```

2. **å‰ç«¯å±•ç¤º** (`static/js/knowledge_graph.js`):
- ä½¿ç”¨ D3.js æˆ– vis.js ç»˜åˆ¶å›¾è°±
- æ”¯æŒäº¤äº’ï¼šç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹è¯¦æƒ…
- æ”¯æŒæœç´¢å’Œè¿‡æ»¤

3. **çŸ¥è¯†åº“** (`data/knowledge_base/`):
- æ„å»º JSON æ ¼å¼çš„çŸ¥è¯†å…³ç³»æ•°æ®
- å®šæœŸæ›´æ–°æ–‡åŒ–ä¼ æ‰¿è„‰ç»œ

---

### 4. å­¦ä¹ è·¯å¾„æ¨èåŠŸèƒ½

**ç›®æ ‡**: æ ¹æ®ç”¨æˆ·å…´è¶£æ¨èä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„

**å®ç°æ–¹æ¡ˆ**:
1. **åç«¯æ¥å£** (`app.py`):
```python
@app.post("/api/learning_path/recommend")
async def recommend_learning_path(request: Request):
    """æ¨èå­¦ä¹ è·¯å¾„"""
    data = await request.json()
    interests = data.get("interests", [])
    
    # æ ¹æ®å…´è¶£æ¨èå­¦ä¹ è·¯å¾„
    paths = {
        "å…¥é—¨": ["å¹¿åºœæ–‡åŒ–æ¦‚è¿°", "åŸºç¡€æ¦‚å¿µ"],
        "è¿›é˜¶": ["ä¸“å®¶å¯¹è¯", "æ·±å…¥å­¦ä¹ "],
        "é«˜çº§": ["ååŒè®¨è®º", "ä¸“ä¸šçŸ¥è¯†"]
    }
    return {"paths": paths}
```

2. **å‰ç«¯é¡µé¢** (`templates/learning_path.html`):
- å±•ç¤ºå­¦ä¹ è·¯å¾„
- æ”¯æŒè¿›åº¦è·Ÿè¸ª

---

### 5. è¯­éŸ³äº¤äº’åŠŸèƒ½

**ç›®æ ‡**: æ”¯æŒè¯­éŸ³è¾“å…¥å’Œè¯­éŸ³è¾“å‡º

**å®ç°æ–¹æ¡ˆ**:
1. **å‰ç«¯å½•éŸ³** (`static/js/voice_interaction.js`):
```javascript
// ä½¿ç”¨ Web Speech API
const recognition = new webkitSpeechRecognition();
recognition.onresult = function(event) {
    const transcript = event.results[0][0].transcript;
    // å‘é€åˆ°åç«¯å¤„ç†
};
```

2. **åç«¯è¯­éŸ³å¤„ç†** (`app.py`):
```python
@app.post("/api/voice/process")
async def process_voice(request: Request):
    """å¤„ç†è¯­éŸ³è¾“å…¥"""
    # è½¬æ¢è¯­éŸ³ä¸ºæ–‡æœ¬
    # è°ƒç”¨ä¸“å®¶æ™ºèƒ½ä½“
    # è¿”å›æ–‡æœ¬å›å¤
    pass

@app.get("/api/voice/synthesize")
async def synthesize_voice(text: str):
    """æ–‡æœ¬è½¬è¯­éŸ³"""
    # ä½¿ç”¨ TTS æœåŠ¡
    pass
```

---

### 6. æ–‡åŒ–æ—¥å†åŠŸèƒ½

**ç›®æ ‡**: å±•ç¤ºå¹¿åºœä¼ ç»ŸèŠ‚æ—¥å’Œé‡è¦æ–‡åŒ–æ—¥æœŸ

**å®ç°æ–¹æ¡ˆ**:
1. **åç«¯æ¥å£** (`app.py`):
```python
@app.get("/api/cultural_calendar/{year}/{month}")
async def get_cultural_calendar(year: int, month: int):
    """è·å–æ–‡åŒ–æ—¥å†"""
    calendar_data = {
        "2024-01-01": {"festival": "å…ƒæ—¦", "culture": "ä¼ ç»ŸèŠ‚åº†"},
        "2024-02-10": {"festival": "æ˜¥èŠ‚", "culture": "æœ€é‡è¦çš„ä¼ ç»ŸèŠ‚æ—¥"},
        # ... æ›´å¤šæ—¥æœŸ
    }
    return {"dates": calendar_data}
```

2. **å‰ç«¯å±•ç¤º** (`templates/calendar.html`):
- æ—¥å†è§†å›¾
- ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…
- å…³è”ä¸“å®¶æ™ºèƒ½ä½“

---

### 7. æ”¹è¿›å¤šè½®å¯¹è¯ä¸ä¸Šä¸‹æ–‡

**ç›®æ ‡**: æ›´å¥½çš„ä¸Šä¸‹æ–‡ç®¡ç†å’Œå¯¹è¯è¿è´¯æ€§

**æ”¹è¿›æ–¹æ¡ˆ**:
1. **å¢å¼ºå¯¹è¯å†å²** (`core/conversation_manager.py`):
```python
class ConversationManager:
    def __init__(self):
        self.history = []
        self.max_history_length = 50  # å¢åŠ å†å²é•¿åº¦
        
    async def add_message(self, role, content, metadata=None):
        """æ·»åŠ æ¶ˆæ¯ï¼Œæ”¯æŒå…ƒæ•°æ®"""
        self.history.append({
            "role": role,
            "content": content,
            "metadata": metadata,
            "timestamp": time.time()
        })
        
    def get_relevant_context(self, query, limit=10):
        """è·å–ç›¸å…³ä¸Šä¸‹æ–‡"""
        # ä½¿ç”¨å‘é‡æ£€ç´¢æˆ–å…³é”®è¯åŒ¹é…
        pass
```

2. **å¯¹è¯çŠ¶æ€ç®¡ç†**:
- è·Ÿè¸ªå¯¹è¯ä¸»é¢˜
- è¯†åˆ«ç”¨æˆ·æ„å›¾
- è‡ªåŠ¨åˆ‡æ¢ä¸“å®¶

---

### 8. å¤šåª’ä½“æ”¯æŒ

**ç›®æ ‡**: æ”¯æŒå›¾ç‰‡ã€éŸ³é¢‘ã€è§†é¢‘çš„å±•ç¤ºå’Œå¤„ç†

**å®ç°æ–¹æ¡ˆ**:
1. **å›¾ç‰‡ä¸Šä¼ ** (`app.py`):
```python
@app.post("/api/upload/image")
async def upload_image(file: UploadFile):
    """ä¸Šä¼ å›¾ç‰‡"""
    # ä¿å­˜å›¾ç‰‡
    # ä½¿ç”¨å›¾åƒè¯†åˆ«APIåˆ†æ
    # è¿”å›æè¿°æ–‡æœ¬
    pass
```

2. **éŸ³é¢‘æ”¯æŒ**:
- ä½¿ç”¨ Web Audio API å½•åˆ¶
- æ”¯æŒéŸ³é¢‘æ–‡ä»¶ä¸Šä¼ 
- æå–éŸ³é¢‘ç‰¹å¾

3. **è§†é¢‘æ”¯æŒ**:
- ä½¿ç”¨ HTML5 video
- æ”¯æŒè§†é¢‘æ’­æ”¾
- å­—å¹•æ˜¾ç¤º

---

### 9. ä¸ªæ€§åŒ–æ¨èåŠŸèƒ½

**ç›®æ ‡**: æ ¹æ®ç”¨æˆ·è¡Œä¸ºå’Œå…´è¶£æ¨èå†…å®¹

**å®ç°æ–¹æ¡ˆ**:
1. **ç”¨æˆ·ç”»åƒ**:
```python
class UserProfile:
    def __init__(self):
        self.interests = []  # ç”¨æˆ·å…´è¶£
        self.history = []     # å¯¹è¯å†å²
        self.preferences = {}  # åå¥½è®¾ç½®
        
    def update_profile(self, interaction):
        """æ›´æ–°ç”¨æˆ·ç”»åƒ"""
        # åˆ†æäº¤äº’æ•°æ®
        # æ›´æ–°å…´è¶£æ ‡ç­¾
        pass
```

2. **æ¨èç®—æ³•**:
- åŸºäºå†…å®¹çš„æ¨è
- ååŒè¿‡æ»¤
- æ··åˆæ¨è

---

## ğŸ“‹ å®ç°ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
1. âœ… èŒ¶æ–‡åŒ–ä¸“å®¶
2. âœ… æ‰‹å·¥è‰ºä¸“å®¶  
3. â­ è¯—è¯æ–‡å­¦ä¸“å®¶
4. â­ ä¸­åŒ»è¯ä¸“å®¶

### ä¸­ä¼˜å…ˆçº§ï¼ˆåŠŸèƒ½å¢å¼ºï¼‰
5. æ–‡åŒ–çŸ¥è¯†å›¾è°±
6. å­¦ä¹ è·¯å¾„æ¨è
7. æ”¹è¿›å¤šè½®å¯¹è¯

### ä½ä¼˜å…ˆçº§ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰
8. è¯­éŸ³äº¤äº’
9. æ–‡åŒ–æ—¥å†
10. å¤šåª’ä½“æ”¯æŒ
11. ä¸ªæ€§åŒ–æ¨è

---

## ğŸ› ï¸ å¼€å‘å»ºè®®

### ä¿æŒåŸæœ‰åŠŸèƒ½
- âœ… æ‰€æœ‰æ–°åŠŸèƒ½éƒ½é€šè¿‡æ–°æ–‡ä»¶å’Œæ–°è·¯ç”±å®ç°
- âœ… ä¸ä¿®æ”¹åŸæœ‰çš„æ ¸å¿ƒé€»è¾‘
- âœ… ä½¿ç”¨æ¥å£æ‰©å±•è€Œéæ›¿æ¢

### ä»£ç è§„èŒƒ
- éµå¾ªç°æœ‰ä»£ç é£æ ¼
- æ·»åŠ é€‚å½“çš„æ³¨é‡Š
- é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

### æµ‹è¯•å»ºè®®
1. å•å…ƒæµ‹è¯•æ¯ä¸ªæ–°åŠŸèƒ½
2. é›†æˆæµ‹è¯•ç¡®ä¿ä¸å½±å“åŸæœ‰åŠŸèƒ½
3. æ€§èƒ½æµ‹è¯•ä¼˜åŒ–å“åº”é€Ÿåº¦

---

## ğŸ“ æ›´æ–°è®°å½•

- 2024-01-XX: åˆ›å»ºæ–‡æ¡£
- 2024-01-XX: å®ç°èŒ¶æ–‡åŒ–ä¸“å®¶ âœ…
- 2024-01-XX: å®ç°æ‰‹å·¥è‰ºä¸“å®¶ âœ…

